<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Impact Score Live AI</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111111">
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin:0; padding:0; }
    h1 { text-align: center; padding: 20px 0; }
    #news-container { max-width: 800px; margin: auto; padding: 10px; }
    .card { border: 1px solid #ccc; margin: 10px 0; padding: 10px; border-radius: 8px; background-color: #fff; transition: 0.3s; }
    .card h3 { margin: 0 0 5px; }
    .card p { margin: 3px 0; }
    .feedback-Accurate { color: green; font-weight: bold; }
    .feedback-Overestimated { color: red; font-weight: bold; }
    .feedback-Underestimated { color: blue; font-weight: bold; }
    #refresh-btn { display: block; margin: 10px auto; padding: 10px 20px; font-size: 16px; border-radius: 8px; cursor: pointer; background-color: #111; color: #fff; border: none; }
    #refresh-btn:hover { background-color: #333; }
  </style>
</head>
<body>
  <h1>Top 25 Știri Live cu Impact Score AI</h1>
  <button id="refresh-btn">Regenerate Scores</button>
  <div id="news-container"></div>

  <script>
    const container = document.getElementById('news-container');
    const refreshBtn = document.getElementById('refresh-btn');

    // === Modifică aici cheia ta NewsAPI ===
    const NEWS_API_KEY = "f343dbe064bf474f9e121aa78e47e3a4";

    async function fetchNews() {
      const res = await fetch(`https://newsapi.org/v2/top-headlines?language=en&pageSize=25&apiKey=${NEWS_API_KEY}`);
      const data = await res.json();
      return data.articles.map(article => ({
        title: article.title,
        content: article.description || "",
        score: 0
      }));
    }

    // === Modifică aici IP-ul calculatorului tău cu backend-ul ===
    const BACKEND_URL = "http://10.13.81.83:3000/score";

    async function getAIScore(title, content) {
      try {
        const res = await fetch(BACKEND_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ title, content })
        });
        const data = await res.json();
        return data.score;
      } catch (e) {
        console.error(e);
        return 50; // fallback dacă serverul nu răspunde
      }
    }

    async function generateScores() {
      container.innerHTML = "";
      const topNews = await fetchNews();

      for (let news of topNews) {
        news.score = await getAIScore(news.title, news.content);

        // Simulare scor real pentru feedback
        news.realScore = Math.max(0, Math.min(100, news.score + (Math.floor(Math.random() * 31) - 15)));
        if (news.realScore > news.score + 5) {
          news.feedback = "Underestimated";
        } else if (news.realScore < news.score - 5) {
          news.feedback = "Overestimated";
        } else {
          news.feedback = "Accurate";
        }
      }

      topNews.sort((a, b) => b.score - a.score);

      topNews.forEach(news => {
        const card = document.createElement('div');
        card.className = "card";
        card.innerHTML = `
          <h3>${news.title}</h3>
          <p><strong>Predicted Impact Score:</strong> ${news.score}</p>
          <p><strong>Real Impact Score:</strong> ${news.realScore}</p>
          <p><strong>Feedback:</strong> <span class="feedback-${news.feedback}">${news.feedback}</span></p>
        `;
        container.appendChild(card);
      });
    }

    generateScores();
    refreshBtn.addEventListener('click', generateScores);
  </script>
</body>
</html>
